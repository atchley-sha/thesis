<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>An Illustrated Comparison of Activity-Based and Trip-Based Models in Utah - 3&nbsp; Methodology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./1_land_use.html" rel="next">
<link href="./lit-review.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./methods.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Methodology</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">An Illustrated Comparison of Activity-Based and Trip-Based Models in Utah</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">List of Acronyms</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lit-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Literature Review</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./methods.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Methodology</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1_land_use.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Land Use</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2_transit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Transit</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3_wfh.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">WFH</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./discussion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Discussion</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#scenarios" id="toc-scenarios" class="nav-link active" data-scroll-target="#scenarios"><span class="header-section-number">3.1</span> Scenarios</a></li>
  <li><a href="#wfrc-model" id="toc-wfrc-model" class="nav-link" data-scroll-target="#wfrc-model"><span class="header-section-number">3.2</span> WFRC Model</a></li>
  <li><a href="#activitysim" id="toc-activitysim" class="nav-link" data-scroll-target="#activitysim"><span class="header-section-number">3.3</span> ActivitySim</a>
  <ul class="collapse">
  <li><a href="#sec-populationsim" id="toc-sec-populationsim" class="nav-link" data-scroll-target="#sec-populationsim"><span class="header-section-number">3.3.1</span> PopulationSim</a></li>
  </ul></li>
  <li><a href="#initial-model-comparisoncalibration" id="toc-initial-model-comparisoncalibration" class="nav-link" data-scroll-target="#initial-model-comparisoncalibration"><span class="header-section-number">3.4</span> Initial model comparison/calibration</a>
  <ul class="collapse">
  <li><a href="#synth-pop" id="toc-synth-pop" class="nav-link" data-scroll-target="#synth-pop"><span class="header-section-number">3.4.1</span> Synth Pop</a></li>
  <li><a href="#outputstrips" id="toc-outputstrips" class="nav-link" data-scroll-target="#outputstrips"><span class="header-section-number">3.4.2</span> Outputs/Trips</a></li>
  </ul></li>
  <li><a href="#computational-resources" id="toc-computational-resources" class="nav-link" data-scroll-target="#computational-resources"><span class="header-section-number">3.5</span> Computational resources</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-methods" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Methodology</span></span></h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  

</header>

<p>We are comparing TBMs to ABMs.</p>
<p>We will forecast several specific scenarios and get an idea of computing resources.</p>
<section id="scenarios" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="scenarios"><span class="header-section-number">3.1</span> Scenarios</h2>
<p>The first scenario is change in land use.</p>
<p>The second scenario is increased transit service.</p>
<p>The third scenario is increased WFH.</p>
<p>All three of these scenarios will be coded in both a representative TBM and ABM.</p>
</section>
<section id="wfrc-model" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="wfrc-model"><span class="header-section-number">3.2</span> WFRC Model</h2>
<p>The Wasatch Front Regional Council (WFRC) model is implemented in the CUBE software by Bentley <span class="citation" data-cites="bentley_systems_cube">(<a href="references.html#ref-bentley_systems_cube" role="doc-biblioref">Bentley Systems n.d.</a>)</span>, and is currently used by WFRC for modeling travel in the Salt Lake City, Utah area. WFRC provided the model directly, including land use forecasts and the current long-range transportation plan. The model is taken mostly as-is, though some changes were made to better accommodate the different scenarios. These modifications are noted in more detail in their respective sections.</p>
<p>The WFRC model, like many trip-based models, requires the following inputs:</p>
<ul>
<li><strong>Land use data.</strong> This includes information about population, employment, and socioeconomic variables such as income, delineated by transportation analysis zone (TAZ). In our case this was provided by WFRC directly, as an output of their land use forecasting model(s).</li>
<li><strong>Travel skims.</strong> This details travel time, cost, etc. between each origin-destination pair of TAZs. The WFRC model uses an iterative process of assigning volumes to the transportation network and recalculating the skims, which are used in the mode and destination choice model steps.</li>
<li><strong>Transportation networks.</strong> These includes highway, transit, etc. networks which connect the TAZs to each other. These networks contain information such as link speed and capacity. Though the WFRC model assigns travel volumes to the network, this research does not compare the model’s network assignment results. However, the network volumes are still used to calculate the loaded network skims.</li>
<li><strong>Model constants and coefficients.</strong> Many model steps, including mode choice, require calibration constants and coefficients. These are taken directly from the WFRC model without modification.</li>
</ul>
<p>How the model works; enumerate and describe each step. Probably multiple paragraphs.</p>
<p>Model outputs.</p>
</section>
<section id="activitysim" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="activitysim"><span class="header-section-number">3.3</span> ActivitySim</h2>
<p>ActivitySim is an open-source activity-based model (ABM) led by a consortium of transportation planning agencies. ActivitySim is highly configurable, and many agencies have their own bespoke implementation. This research uses an ActivitySim implementation based on <span class="citation" data-cites="macfarlane2021">(<a href="references.html#ref-macfarlane2021" role="doc-biblioref"><strong>macfarlane2021?</strong></a>)</span>, which is in turn based on the prototype configuration for the Metropolitan Transportation Commission serving the San Francisco area <span class="citation" data-cites="cite">(<a href="references.html#ref-cite" role="doc-biblioref"><strong>cite?</strong></a>)</span>.</p>
<p>ActivitySim requires similar inputs to the WFRC model, though it does not assign traffic and so does not require any transportation networks. Additionally, ActivitySim requires population data at an individual level, including information such as household income, age, and home location. Due to privacy concerns, real data is rarely used for this purpose, and a synthetic population representative of the study area is used instead. <a href="#sec-populationsim"><span>Section&nbsp;3.3.1</span></a> discusses the population used in this research.</p>
<p>ActivitySim, like all ABMs, simulates transportation decisions on an individual level. ActivitySim has a hierarchical decision tree, where long-term decisions (such as auto ownership and telecommute frequency) are made first, followed by daily and tour- and trip-level decisions such as scheduling and mode choice (see <a href="#fig-asim-flowchart">Figure&nbsp;<span>3.1</span></a>). Each of these steps determines information that will be used in subsequent steps. Most of these can be turned on or off depending on what is needed for the model implementation.</p>
<div id="fig-asim-flowchart" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/abmexample.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;3.1: ActivitySim sub-model flowchart. Long-term decisions are made first, followed by more granular ones.</figcaption>
</figure>
</div>
<p>The steps can broadly be categorized into five groups, as shown in <a href="#fig-asim-flowchart">Figure&nbsp;<span>3.1</span></a>. These are aggregate, household/personal, daily, tour-level, and trip-level. The aggregate steps mainly involve determining impedance measures between each pair of zones (travel time, distance, cost, etc.). In this case, these impedances are supplied directly as network skims, output from the WFRC model.</p>
<p>The household/personal steps relate to long-term decisions that are unlikely to change quickly based on daily transportation conditions. These steps include determining remote work status, work/school location, auto ownership, transit pass ownership, and free parking availability at work. Much of this information can be supplied directly or explicitly modeled. This implementation does not supply any of this information directly, and explicitly models remote work status, work/school location, auto ownership, and free parking availability. Transit pass ownership is not modeled.</p>
<p>The day-level decisions primarily concern an individual’s daily activity pattern (DAP). ActivitySim contains a step to assign mandatory, joint, and non-mandatory tours based on personal and household information (joint tours combine both mandatory and non-mandatory activities). For example, full-time workers are more likely to make a mandatory tour than part-time workers, all else being equal. <strong><em>one more sentence?</em></strong></p>
<p>Once a DAP is chosen, ActivitySim creates tours for each major activity in the day. Additionally, ActivitySim determines if an individual makes an “at-work” tour (e.g.&nbsp;leaving for lunch and returning to the workplace). Each tour is scheduled and assigned a primary mode, as well as a primary destination for non-mandatory and joint tours. The tours are then populated with trips, and ActivitySim assigns each trip an origin, destination, time, mode, etc. compatible with the tour-level assignment.</p>
<p>The final steps of ActivitySim are writing the trip matrices and other tables including information on land use, persons, households, tours, and trips. This can also include writing summary tables of the above information.</p>
<section id="sec-populationsim" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="sec-populationsim"><span class="header-section-number">3.3.1</span> PopulationSim</h3>
<p>This research uses PopulationSim <span class="citation" data-cites="cite">(<a href="references.html#ref-cite" role="doc-biblioref"><strong>cite?</strong></a>)</span> to create a synthetic population for ActivitySim. The synthetic population aims to be representative of the study area while maintaining privacy. PopulationSim takes as input a “seed” of individuals and households, and populates the area with copies of these to match given control totals.</p>
<p>This research uses a seed sample from the American Community Survey (ACS) Public Use Microdata Sample (PUMS), which contains a sample of actual (anonymized) individuals and households at the PUMA level. PUMAs partition the United States into areas of around (and no fewer than) 100,000 people each <span class="citation" data-cites="census2023">(<a href="references.html#ref-census2023" role="doc-biblioref"><strong>census2023?</strong></a>)</span>. The control totals come from two different sources: the Census and the WFRC model. <a href="#tbl-control-totals">Table&nbsp;<span>3.1</span></a> shows these controls as well as their geographic level and source. PopulationSim also allows setting different weights to each control, and <a href="#tbl-control-totals">Table&nbsp;<span>3.1</span></a> gives this information as well.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-control-totals" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;3.1: PopulationSim Control Totals by Geography and Source (with Weights)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Control</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Geography</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Source</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Population</td>
<td style="text-align: center;">Entire Region</td>
<td style="text-align: center;">Census</td>
<td style="text-align: center;">5,000</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of Households</td>
<td style="text-align: center;">TAZ</td>
<td style="text-align: center;">WFRC Model</td>
<td style="text-align: center;">1,000,000,000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Household Size</td>
<td style="text-align: center;">Census Tract</td>
<td style="text-align: center;">Census</td>
<td style="text-align: center;">10,000</td>
</tr>
<tr class="even">
<td style="text-align: left;">Persons by Age Group</td>
<td style="text-align: center;">Census Tract</td>
<td style="text-align: center;">Census</td>
<td style="text-align: center;">10,000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Households by Income Group</td>
<td style="text-align: center;">Census Tract</td>
<td style="text-align: center;">Census</td>
<td style="text-align: center;">500</td>
</tr>
<tr class="even">
<td style="text-align: left;">Workers per Household</td>
<td style="text-align: center;">Census Tract</td>
<td style="text-align: center;">Census</td>
<td style="text-align: center;">1,000</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>Most of these controls come from Census data, with only the number of households per TAZ coming from the WFRC model data. <strong><em>Justification</em></strong>. Note also that there are many personal and household variables that are not accounted for in these controls, such as sex, vehicle ownership, internet access, etc. These are not controlled for and are dependent on which seed persons or households are copied in controlling for the other variables. However, this is assumed to still give a representative enough estimate for the uncontrolled variables without needing to model them explicitly.</p>
<p>The outputs of PopulationSim include a persons and households table comprising the synthetic population, as well as summary tables.</p>
</section>
</section>
<section id="initial-model-comparisoncalibration" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="initial-model-comparisoncalibration"><span class="header-section-number">3.4</span> Initial model comparison/calibration</h2>
<p>Though we are not comparing the outputs of ActivitySim to the WFRC model directly, it is still important to ensure the two models perform similarly to each other for any comparisons to be meaningful. We created a “baseline” scenario in both models in order to calibrate our ActivitySim implementation to the WFRC model. This baseline scenario uses the 2019 WFRC model as-is, and uses 2019 Census and land use data for ActivitySim.</p>
<section id="synth-pop" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="synth-pop"><span class="header-section-number">3.4.1</span> Synth Pop</h3>
<p>We compared key attributes (taz population, income, etc). Number of HH is identical.</p>
<p>Comparison of population totals.</p>
<p>Comparison of median income.</p>
<p>Comparison of income groups.</p>
</section>
<section id="outputstrips" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="outputstrips"><span class="header-section-number">3.4.2</span> Outputs/Trips</h3>
<p>We compared mode split, tlfd, and wfh.</p>
<p>Mode split comparison/calibration.</p>
<p>TLFD comparison.</p>
<p>WFH comparison/calibration.</p>
</section>
</section>
<section id="computational-resources" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="computational-resources"><span class="header-section-number">3.5</span> Computational resources</h2>
<p>?</p>
<p>? Our results include the experience of coding the scenarios and analyses as well as the analyses themselves.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-bentley_systems_cube" class="csl-entry" role="listitem">
Bentley Systems. n.d. <span>“<span>CUBE</span> <span>Modeling</span> <span>Software</span>.”</span> Accessed October 3, 2023. <a href="https://www.bentley.com/software/cube/">https://www.bentley.com/software/cube/</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./lit-review.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Literature Review</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./1_land_use.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Land Use</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>