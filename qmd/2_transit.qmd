# Scenario 2: Improved Transit Service {#sec-transit}

{{< include _setup.qmd >}}

The basis for the transit scenario is a set of proposed improvements to the FrontRunner commuter rail line connecting Ogden, Provo, and Salt Lake City.
The proposals would extend the extent of the service, increase the service frequency by constructing dedicated double tracks, and marginally increase the speed between stations by replacing the current diesel-electric locomotives with electric trainsets drawing power from overhead wires.

## Scenario Creation

This scenario is straightforward in both models.
In the WFRC/MAG model, we simply use the network with increased speeds, frequencies, and additional stations constructed for the most recent long range plan.
We then replace the impedances for transit used in the ActivitySim accessibility module with the new impedances representing the improved transit scenario.

## Scenario Analysis

@tbl-tr-mode-split shows the number of trips by purpose and mode for each model, and compares these results between this scenario and the baseline scenario.
Unsurprisingly, both models predict a significant increase in commuter rail trips.
The models differ, however, in which modes the new commuter rail trips come from.

```{r}
#| label: tbl-tr-mode-split
#| tbl-cap: Change in Mode Split with Improved Transit

targets::tar_read(combined_tr_mode_split_table) %>%
	mutate(mode = case_match(mode, "Local Transit" ~ "Local Transit\u00b2", .default = mode)) %>% 
	skbl(col.names = c("Purpose", "Mode", rep(c("Baseline Trips", "Transit\u00b9 Trips", "Change"), 2))) %>%
	kable_styling() %>% 
	add_header_above(c(" " = 2, "WFRC Model" = 3, "ActivitySim" = 3)) %>% 
	collapse_rows(1, latex_hline = "major") %>% 
	kableExtra::footnote(number = c("\"Transit\" here refers to the Transit scenario, not the mode of travel", "\"Local Transit\" includes both light rail and bus travel"))
```

For Home-based Other and Non--home-based trips, the WFRC model shows virtually no change in the number of auto and non-motorized trips, while there is a significant decrease in the number of local transit trips.
Home-based Work trips do see a decrease in auto trips with the improved transit, but there are still significantly fewer local transit trips compared to the baseline scenario.
This indicates that the new commuter rail trips are mostly coming from those who would have taken local transit in the baseline scenario.

ActivitySim, on the other hand, actually shows an *increase* in local transit trips for Home-based Work and Non--home-based trips.
For Home-based Other trips, there is a decrease in local transit, but by percentage it is not nearly as significant as the decrease in the WFRC model.\[\^2_transit-1\] The absolute difference in *number* of Home-based Other local transit trips between the scenarios is comparable between the two models, but since ActivitySim is predicting significantly more transit trips in the baseline scenario compared to the WFRC model, the percent change is much smaller in ActivitySim.
This shows that most new commuter rail trips in ActivitySim are coming from auto (drive alone and carpool) modes, rather than other transit modes.

The discrepancy may be partially explained by the difference in the way trips are modeled.
In the WFRC model, trips are modeled in aggregate, with no interaction between separate trips.
Regardless of trip purpose, trips are treated essentially the same, though potentially with different coefficients in mode choice equations.
Even Non--home-based trips are treated like any other trip during mode choice.
The transit "nest" contains all transit modes, and so when the commuter rail service is improved the utility of commuter rail compared to other transit modes increases more than the utility of commuter rail compared to non-transit modes.
Many of the new commuter rail trips therefore come from those who would have taken transit otherwise.

ActivitySim, however, *does* model interactions between trips.
An individual who makes a commuter rail trip will (usually) not be able to drive for other trips on that tour.
Individuals taking commuter rail are more likely to then take other forms of transit on the same tour.

One particularly interesting analysis that can be done with an ABM is to see who changed modes with the improved transit.
Because trips are modeled individually rather than in aggregate, it is possible to identify trips that switch modes between the scenarios.
@fig-tr-mode-switching shows the distribution of these "switched" trips.
These are trips that are "the same" between scenarios and differ only by mode.
For the purposes of this analysis, trips are considered "the same" between scenarios if they are made by the same person and have the same origin and destination zones, time of day, and tour and trip purpose.
Most of these trips also share the same mode, which is to be expected, but many do not.
@fig-tr-mode-switching is filtered to show only trips that do not share the same mode between scenarios.

```{r}
#| label: fig-tr-mode-switching
#| fig-cap: Trip mdoes of individuals who switched modes with improved transit service.
#| fig-width: 6.5
#| fig-height: 8
mode_switching <- targets::tar_read(asim_tr_mode_switching)
mode_switching %>%
		mutate(
			from = mode_by,
			to = mode_tr,
			tour_purpose = case_match(
				tour_purpose,
				c("work", "school", "univ") ~ tour_purpose,
				c("school", "univ") ~ "school",
				.default = "other"
			)
		) %>%
		count(tour_purpose, from, to) %>%
		filter(from != "rh", to != "rh") %>%
		mutate(
			tour_purpose = factor(
				tour_purpose,
				levels = c("work", "school", "univ", "other"),
				labels = c("Work", "School", "University", "Other")
			),
			across(c(from, to), \(x) pretty_mode(x))) %>%
		ggplot(aes(axis1 = from, axis2 = to, y = n)) +
		list(if(length(unique(mode_switching$tour_purpose)) > 1) facet_wrap(~tour_purpose, scales = "free")) +
		# facet_wrap(~tour_purpose, scales = "free") +
		scale_x_discrete(
			limits = c("From", "To"),
			labels = c("Baseline\nScenario", "Improved\nTransit"),
			expand = c(.2, .1)) +
		geom_alluvium(aes(fill = from), width = 1/2, alpha = 0.8) +
		geom_stratum(width = 1/2) +
		geom_text(stat = "stratum", aes(label = after_stat(stratum))) +
		# scale_fill_brewer(palette = "Accent") +
		scale_fill_bright() +
		labs(x = element_blank(), y = "Trips", fill = "Original mode")
```

There is some amount of randomness in the way ActivitySim determines trip modes, though.
This randomness is seen partly in trips that switch away from commuter rail despite the improved commuter rail service, as well as some trips that switch to modes other than commuter rail, especially to drive alone.
Although, part of the switch from carpool to drive alone can be explained as previously-carpool trips where all but one vehicle occupant switched to another mode, leaving one person in the vehicle for the trip.
Overall, though, the randomness is not a significant portion of the overall mode switching seen in @fig-tr-mode-switching.

Both model types additionally allow for analyzing the types of people who use transit.
@fig-tr-se-income-dist shows the income distribution of transit riders in the improved transit scenario, but these distributions are substantively different in both analysis method and outcome.
In the case of ActivitySim, we obtained the income of each modeled transit rider and plotted the distribution of their incomes.
For the WFRC/MAG model, we looked at the production zones of the mode choice model matrices, obtained the median income of those zones, and then weighted the distribution by the number of trips produced in each zone.
The ActivitySim analysis is more straightforward, and also leads to a potentially different interpretation of the modeling results: the income distributions of Commuter Rail riders appears similar for all three purposes in the WFRC/MAG model, but ActivitySim shows very different distributions of income.

```{r}
#| label: fig-tr-se-income-dist
#| fig-cap: Income distribution of transit riders in both models. The distribution of TAZ median income weighted by transit trips is used for the WFRC model, while for ActivitySim the actual income distribution of transit riders is used.
#| fig-scap: Income distribution of transit riders in both models.
#| fig-width: 5
#| fig-height: 6

targets::tar_read(combined_tr_new_transit_income_plot) +
	scale_x_continuous(limits = c(NA,2e5), labels = label_currency(scale_cut = cut_short_scale())) +
	scale_color_bright() +
	theme(legend.position = "bottom")
```
