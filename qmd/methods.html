<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>A Comparative Illustration of Trip- and Activity-Based Modeling Techniques - 3&nbsp; Methodology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../qmd/1_land_use.html" rel="next">
<link href="../qmd/lit-review.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../qmd/methods.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Methodology</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">A Comparative Illustration of Trip- and Activity-Based Modeling Techniques</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">List of Acronyms</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/lit-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Literature Review</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/methods.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Methodology</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/1_land_use.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Scenario 1: Change in Land Use</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2_transit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Scenario 2: Increased Transit Service</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/3_wfh.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Scenario 3: Increase in Remote Work</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/conclusions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Conclusions and Recommendations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#wfrc-model" id="toc-wfrc-model" class="nav-link active" data-scroll-target="#wfrc-model"><span class="header-section-number">3.1</span> WFRC Model</a></li>
  <li><a href="#activitysim" id="toc-activitysim" class="nav-link" data-scroll-target="#activitysim"><span class="header-section-number">3.2</span> ActivitySim</a></li>
  <li><a href="#initial-model-comparisoncalibration" id="toc-initial-model-comparisoncalibration" class="nav-link" data-scroll-target="#initial-model-comparisoncalibration"><span class="header-section-number">3.3</span> Initial Model Comparison/Calibration</a></li>
  <li><a href="#example-scenarios" id="toc-example-scenarios" class="nav-link" data-scroll-target="#example-scenarios"><span class="header-section-number">3.4</span> Example Scenarios</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-methods" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Methodology</span></span></h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<!-- Include at the start of every doc -->
<p>This paper seeks to compare methodological differences between trip- and activity-based modeling frameworks. The Wasatch Front Regional Council (WFRC) travel demand model is used as a representative trip-based model, and an ActivitySim implementation in the same study area is used as a representative activity-based model (ABM). Note that the focus is not on comparing model accuracy or performance, but rather on comparing the process of using each model, including the types of analyses that can be performed. There are therefore few direct comparisons of model outputs between each type. Instead, this research highlights the strengths and weaknesses of each model type in planning and policy analysis, and illustrates these differences.</p>
<p>The following sections discuss the specific models in more detail.</p>
<section id="wfrc-model" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="wfrc-model"><span class="header-section-number">3.1</span> WFRC Model</h2>
<p>The WFRC model is implemented in the CUBE software by Bentley <span class="citation" data-cites="bentley_systems_cube">(<a href="references.html#ref-bentley_systems_cube" role="doc-biblioref">Bentley Systems n.d.</a>)</span>, and is currently used by WFRC for modeling travel in the Salt Lake City, Utah area. WFRC provided the model directly, including land use forecasts and the current long-range transportation plan. The model is taken essentially as-is, with no changes other than those noted in Chapters <a href="1_land_use.html" class="quarto-xref"><span>4</span></a>–<a href="3_wfh.html" class="quarto-xref"><span>6</span></a>.</p>
<p>The WFRC model, like many trip-based models, requires the following inputs:</p>
<ul>
<li>Land use data, including information about population, employment, and socioeconomic variables such as income, delineated by transportation analysis zone (TAZ). This is provided by WFRC directly, as an output of their land use forecasting model(s).</li>
<li>Travel skims, detailing travel time, cost, etc. between each origin-destination pair of TAZs. The WFRC model uses an iterative process of assigning volumes to the transportation network and recalculating the skims, which are used in the mode and destination choice model steps.</li>
<li>Transportation networks, including highway, transit, etc.&nbsp;networks which connect the TAZs to each other. These networks contain information such as link speed and capacity. Though the WFRC model assigns travel volumes to the network, this paper does not compare the model’s network assignment results. However, the network volumes are still used to calculate the loaded network skims.</li>
<li>Lookup tables, used in many model steps for information such as trip rates by household type. These are taken directly from the WFRC model without modification.</li>
<li>Model constants and coefficients, which some model steps such as mode choice require for calibration. These are also taken directly from the WFRC model.</li>
</ul>
<p>Like many trip-based models, the WFRC model follows the “four-step” approach and has main steps of trip generation, trip distribution, mode choice, and network assignment. The model also includes a disaggregation step at the beginning where the TAZ-level data is used via lookup tables to estimate the number of households by size, income group, number of workers, and auto ownership. The trip generation step uses lookup tables for each household type to determine the number of trips produced by purpose. Trip attractions are determined based on the number of jobs in each TAZ, with differing coefficients by job type. Trip distribution uses a gravity model of the form<br>
<span class="math display">\[
T_{ij} = P_i \times \frac{A_j  F_{ij}}{\displaystyle \sum_J A_j  F_{ij}},
\]</span><br>
where <span class="math inline">\(T_{ij}\)</span> is the number of trips from zone <span class="math inline">\(i\)</span> to <span class="math inline">\(j\)</span>, <span class="math inline">\(P_i\)</span> is the productions at <span class="math inline">\(i\)</span>, <span class="math inline">\(A_j\)</span> is the attractions at <span class="math inline">\(j\)</span>, <span class="math inline">\(F_{ij}\)</span> is the cost term/function from <span class="math inline">\(i\)</span> to <span class="math inline">\(j\)</span>, and <span class="math inline">\(J\)</span> is the set of all zones trips from <span class="math inline">\(i\)</span> can be attracted to. Mode choice uses a choice model to assign a percentage of trips of each purpose to each mode. Network assignment is done via an iterative process to equalize travel time between potential routes.</p>
<p>The WFRC model outputs include trip tables by purpose, mode, and time of day, as well as loaded network skims.</p>
</section>
<section id="activitysim" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="activitysim"><span class="header-section-number">3.2</span> ActivitySim</h2>
<p>ActivitySim is an open-source ABM led by a consortium of transportation planning agencies. ActivitySim is highly configurable, and many agencies have their own bespoke implementation. This paper uses an ActivitySim implementation based on <span class="citation" data-cites="gregory_s_macfarlane_estimation_2021">Gregory S. Macfarlane and Nathan J. Lant (<a href="references.html#ref-gregory_s_macfarlane_estimation_2021" role="doc-biblioref">2021</a>)</span>, which is in turn based on the prototype configuration for the Metropolitan Transportation Commission serving the San Francisco area <span class="citation" data-cites="erhardt_mtcs_2011">(<a href="references.html#ref-erhardt_mtcs_2011" role="doc-biblioref">Erhardt et al. 2011</a>)</span>. The exact implementation is available <a href="https://github.com/byu-transpolab/wfrc_asim_scenario/tree/update-abm-illustration">on GitHub</a>.</p>
<p>ActivitySim requires similar inputs to the WFRC model, though it does not assign traffic and so does not require any transportation networks. However, ActivitySim does require network skims for information on travel time, cost, etc. These skims are obtained from any network assignment process, though ActivitySim itself does not include network assignment. A discussion and comparison of network assignment processes is outside the scope of this project, so this ActivitySim implementation uses the travel skims output from the WFRC model directly.</p>
<p>ActivitySim additionally requires population data at an individual level, including information such as age, household income, and home location. Due to privacy concerns, real data is rarely used for this purpose, and a synthetic population representative of the study area is used instead. <a href="#sec-populationsim" class="quarto-xref"><span>Section 3.2.1</span></a> discusses the population used in more detail.</p>
<p>ActivitySim, like all ABMs, simulates transportation decisions on an individual level. ActivitySim has a hierarchical decision tree, where long-term decisions (such as auto ownership and telecommute frequency) are made first, followed by daily and tour- and trip-level decisions such as scheduling and mode choice (see <a href="#fig-asim-flowchart" class="quarto-xref">Figure&nbsp;<span>3.1</span></a>). Each of these steps determines information that will be used in subsequent steps, and many steps can be turned on or off depending on what is needed for the model implementation.</p>
<div id="fig-asim-flowchart" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-scap="ActivitySim sub-model flowchart.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-asim-flowchart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../images/abmexample.jpg" class="img-fluid figure-img" data-fig-scap="ActivitySim sub-model flowchart.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-asim-flowchart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.1: ActivitySim sub-model flowchart. Long-term decisions are made first, followed by more granular ones.
</figcaption>
</figure>
</div>
<p>The steps can broadly be categorized into five groups, as shown in <a href="#fig-asim-flowchart" class="quarto-xref">Figure&nbsp;<span>3.1</span></a>: aggregate, household/personal, daily, tour-level, and trip-level steps. The aggregate steps mainly involve determining impedance measures between each pair of zones (travel time, distance, cost, etc.). In this case, these impedances are supplied directly as network skims, output from the WFRC model.</p>
<p>The household/personal steps relate to long-term decisions that are unlikely to change quickly based on daily transportation conditions. These steps include determining remote work status, work/school location, auto ownership, transit pass ownership, and free parking availability at work. Much of this information can be supplied directly or explicitly modeled. This ActivitySim implementation does not supply any of this information directly, and explicitly models remote work status, work/school location, auto ownership, and free parking availability. Transit pass ownership is not modeled.</p>
<p>The daily decisions primarily concern an individual’s DAP. ActivitySim contains a step to assign mandatory, non-mandatory, and joint tours based on personal and household information (joint tours combine both mandatory and non-mandatory activities). For example, full-time workers are more likely to make a mandatory tour than part-time workers, all else being equal.</p>
<p>Once a DAP is chosen, ActivitySim creates tours for each major activity in the day. Additionally, ActivitySim determines if an individual makes an “at-work” tour (e.g.&nbsp;leaving for lunch and returning to the workplace). Each tour is scheduled and assigned a primary mode, as well as a primary destination for non-mandatory and joint tours. The tours are then populated with trips, and ActivitySim assigns each trip a purpose, destination, time of day, and mode compatible with the tour-level assignment.</p>
<p>The final steps of ActivitySim are writing output trip matrices and other tables, including information on land use, persons, households, tours, and trips. <!-- This can also include writing summary tables of the above information. --></p>
<section id="sec-populationsim" class="level3">
<h3 class="anchored" data-anchor-id="sec-populationsim">PopulationSim</h3>
<p>This paper uses PopulationSim <span class="citation" data-cites="populationsim_2023">(<a href="references.html#ref-populationsim_2023" role="doc-biblioref">Association of Metropolitan Planning Organizations 2023</a>)</span> to create a synthetic population for ActivitySim. The synthetic population aims to be representative of the study area while maintaining privacy. PopulationSim takes as input a “seed” of individuals and households, and populates the area with copies of these to match given control totals.</p>
<p>The seed sample comes from the 2019 American Community Survey Public Use Microdata Sample <span class="citation" data-cites="pums">(<a href="references.html#ref-pums" role="doc-biblioref">U.S. Census Bureau 2022</a>)</span>, which contains a sample of actual (anonymized) individuals and households at the Public Use Microdata Area (PUMA) geography (PUMAs partition the United States into areas of around 100,000 people each <span class="citation" data-cites="puma">(<a href="references.html#ref-puma" role="doc-biblioref">U.S. Census Bureau 2023</a>)</span>). The control totals come from two different sources: the U.S. Census and the WFRC model. <a href="#tbl-control-totals" class="quarto-xref">Table&nbsp;<span>3.1</span></a> shows these controls as well as their geographic level and source. PopulationSim also allows setting different weights to each control, and <a href="#tbl-control-totals" class="quarto-xref">Table&nbsp;<span>3.1</span></a> gives this information as well.</p>
<div class="cell">
<div id="tbl-control-totals" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-control-totals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.1: PopulationSim Control Totals by Geography and Source
</figcaption>
<div aria-describedby="tbl-control-totals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div>
<table class="table do-not-create-environment cell table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Control</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Geography</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Source</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Population</td>
<td style="text-align: center;">Entire Region</td>
<td style="text-align: center;">Census</td>
<td style="text-align: right;">5,000</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of Households</td>
<td style="text-align: center;">TAZ</td>
<td style="text-align: center;">WFRC Model</td>
<td style="text-align: right;">1,000,000,000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Household Size</td>
<td style="text-align: center;">Census Tract</td>
<td style="text-align: center;">Census</td>
<td style="text-align: right;">10,000</td>
</tr>
<tr class="even">
<td style="text-align: left;">Persons by Age Group</td>
<td style="text-align: center;">Census Tract</td>
<td style="text-align: center;">Census</td>
<td style="text-align: right;">10,000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Households by Income Group</td>
<td style="text-align: center;">Census Tract</td>
<td style="text-align: center;">Census</td>
<td style="text-align: right;">500</td>
</tr>
<tr class="even">
<td style="text-align: left;">Workers per Household</td>
<td style="text-align: center;">Census Tract</td>
<td style="text-align: center;">Census</td>
<td style="text-align: right;">1,000</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</figure>
</div>
</div>
<p>Most of these controls come from Census data, with only the number of households per TAZ coming from the WFRC model data. Note also that there are many personal and household variables that are not accounted for in these controls, such as sex, vehicle ownership, internet access, etc. These variables are not controlled for and are dependent on which seed persons or households are copied in controlling for the other variables. However, this process is assumed to still give a representative enough estimate for the uncontrolled variables without needing to model them explicitly.</p>
<p>The outputs of PopulationSim include a persons and households table comprising the synthetic population, as well as summary tables.</p>
</section>
</section>
<section id="initial-model-comparisoncalibration" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="initial-model-comparisoncalibration"><span class="header-section-number">3.3</span> Initial Model Comparison/Calibration</h2>
<p>While this research does not directly compare the outputs of ActivitySim to those of the WFRC model, it is important to ensure similar performance between the two models for meaningful analyses. As such, a baseline scenario in both models is used in order to calibrate the ActivitySim implementation to the WFRC model. This baseline scenario uses the 2019 WFRC model as-is. For ActivitySim, the baseline scenario uses 2019 Census and WFRC data to create the synthetic population, and the choice models use land use data and network skims from the baseline WFRC scenario.</p>
<section id="verification-of-the-synthetic-population" class="level3">
<h3 class="anchored" data-anchor-id="verification-of-the-synthetic-population">Verification of the Synthetic Population</h3>
<p>The controls for PopulationSim mostly come from the Census, as can be seen in <a href="#tbl-control-totals" class="quarto-xref">Table&nbsp;<span>3.1</span></a>. However, the WFRC model contains TAZ-level data including population and median income. The WFRC model also has a disaggregation step that estimates the number of households by size and income group. <!-- and number of workers --><br>
This section compares the output of PopulationSim to the WFRC model on each of these variables at the TAZ level.</p>
<p><a href="#fig-population-comparison" class="quarto-xref">Figure&nbsp;<span>3.2</span></a> shows the difference in TAZ population between PopulationSim and the WFRC data. It is worth noting that since the number of households was controlled at the TAZ level from the WFRC data with an extremely high weight, the number of households per TAZ in the synthetic population match exactly to the WFRC data. The average household size will therefore follow a similar error distribution to the one shown in <a href="#fig-population-comparison" class="quarto-xref">Figure&nbsp;<span>3.2</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-population-comparison" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-population-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="methods_files/figure-html/fig-population-comparison-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-population-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.2: population comparison
</figcaption>
</figure>
</div>
</div>
</div>
<p>The population per TAZ is similar to the WFRC data in most places, though there are some discrepancies especially near Herriman and Lehi. Since total population is a region-level control, but number of households is a TAZ-level control, this shows PopulationSim is predicting a smaller average household size in Herriman and Lehi than the WFRC data suggests. <!-- This may be reasonable, as these are suburban areas which are likely to have larger household sizes on average than places like Salt Lake City. --></p>
<p>Income is also an important factor in travel behavior <span class="citation" data-cites="zegras_household_2007">(<a href="references.html#ref-zegras_household_2007" role="doc-biblioref">Zegras and Srinivasan 2007</a>)</span>, and <a href="#fig-median-income-comparison" class="quarto-xref">Figure&nbsp;<span>3.3</span></a> shows a TAZ-level comparison of median income between the synthetic population and the WFRC data. The synthetic population does have a lower median income than the WFRC data in many TAZs, but the error is in most cases fairly small, especially in more populated areas. However, both the WFRC model and ActivitySim use household income <em>groups</em> rather than individual household income to inform travel decisions. These groups are taken from the WFRC model (see <a href="#tbl-income-groups" class="quarto-xref">Table&nbsp;<span>3.2</span></a>), and the groups in PopulationSim and ActivitySim were adjusted to match. <a href="#fig-income-group-map" class="quarto-xref">Figure&nbsp;<span>3.4</span></a> shows the difference in number of households by income group, and this figure shows a similar trend of PopulationSim over-predicting low-income households.</p>
<div class="cell">
<div id="tbl-income-groups" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-income-groups-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.2: income groups
</figcaption>
<div aria-describedby="tbl-income-groups-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div>
<table class="table do-not-create-environment cell table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Income Group</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Income Range</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: right;">≤ $45,000</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: right;">$45,000–$75,000</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: right;">$75,000–$125,000</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: right;">≥ $125,000</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-median-income-comparison" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-median-income-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="methods_files/figure-html/fig-median-income-comparison-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-median-income-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.3: med inc
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-income-group-map" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-income-group-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="methods_files/figure-html/fig-income-group-map-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-income-group-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.4: inc groups
</figcaption>
</figure>
</div>
</div>
</div>
<p>Income was not weighted very heavily as a control in PopulationSim (see <a href="#tbl-control-totals" class="quarto-xref">Table&nbsp;<span>3.1</span></a>), and this is in part why there are discrepancies between the models. However, the overall distribution of income is similar between the models, as <a href="#fig-median-income-density" class="quarto-xref">Figure&nbsp;<span>3.5</span></a> shows. <!-- A production-ready synthetic population would match its income distribution more closely to the existing WFRC model, but for the purposes of this research the income distribution is similar enough. --></p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-median-income-density" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-median-income-density-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="methods_files/figure-html/fig-median-income-density-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-median-income-density-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.5: inc density
</figcaption>
</figure>
</div>
</div>
</div>
<!-- ***Comparison of number of workers?*** -->
</section>
<section id="sec-baseline-calibration" class="level3">
<h3 class="anchored" data-anchor-id="sec-baseline-calibration">Verification and Calibration of ActivitySim</h3>
<p>This section compares the outputs of both models to verify that trip patterns roughly agree between them. There are three comparisons of interest between the outputs of the two models: mode split, trip length frequency distribution, and remote work.</p>
<p>The initial baseline ActivitySim scenario predicted a mode split significantly different to that from the WFRC model, and so calibration efforts were needed. We adjusted the alternative-specific constants in ActivitySim’s mode choice model to better match the mode split in the WFRC model. <a href="#tbl-mode-split" class="quarto-xref">Table&nbsp;<span>3.3</span></a> compares the mode split of both models after several iterations of this calibration. Overall, the calibration resulted in a reasonably similar mode split between the two models, though there are still discrepancies (e.g.&nbsp;ActivitySim is predicting about twice as many transit trips as the WFRC model). However, further adjustment of the constants would cause their values to become unreasonably large, as ActivitySim’s mode split begins converging at this point regardless of the calibration constant values (see <a href="#fig-calibration-plot" class="quarto-xref">Figure&nbsp;<span>3.6</span></a>). This is likely due to the mode choice coefficients being unrepresentative of the study area. This ActivitySim configuration is ultimately based on the San Francisco area, and so coefficients on variables such as travel time and income are calibrated for that area (hence in part why there are so many more transit trips).</p>
<div class="cell">
<div id="tbl-mode-split" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-mode-split-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.3: mode split
</figcaption>
<div aria-describedby="tbl-mode-split-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div>
<table class="table do-not-create-environment cell table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Purpose</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Mode</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">ActivitySim predicted trips</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">WFRC predicted trips</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Error</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">% Error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Auto</td>
<td style="text-align: center;">Home-based Other</td>
<td style="text-align: center; width: 3cm;">3253220</td>
<td style="text-align: center; width: 3.5cm;">4096688</td>
<td style="text-align: center;">-843468</td>
<td style="text-align: center; width: 3.7cm;">-20.6%</td>
</tr>
<tr class="even">
<td style="text-align: center;">Non-motorized</td>
<td style="text-align: center;">Home-based Other</td>
<td style="text-align: center; width: 3cm;">532274</td>
<td style="text-align: center; width: 3.5cm;">510143</td>
<td style="text-align: center;">22131</td>
<td style="text-align: center; width: 3.7cm;">4.3%</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Transit</td>
<td style="text-align: center;">Home-based Other</td>
<td style="text-align: center; width: 3cm;">67396</td>
<td style="text-align: center; width: 3.5cm;">37346</td>
<td style="text-align: center;">30050</td>
<td style="text-align: center; width: 3.7cm;">80.5%</td>
</tr>
<tr class="even">
<td style="text-align: center;">Auto</td>
<td style="text-align: center;">Home-based Work</td>
<td style="text-align: center; width: 3cm;">1524169</td>
<td style="text-align: center; width: 3.5cm;">1586414</td>
<td style="text-align: center;">-62245</td>
<td style="text-align: center; width: 3.7cm;">-3.9%</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Non-motorized</td>
<td style="text-align: center;">Home-based Work</td>
<td style="text-align: center; width: 3cm;">83119</td>
<td style="text-align: center; width: 3.5cm;">76506</td>
<td style="text-align: center;">6613</td>
<td style="text-align: center; width: 3.7cm;">8.6%</td>
</tr>
<tr class="even">
<td style="text-align: center;">Transit</td>
<td style="text-align: center;">Home-based Work</td>
<td style="text-align: center; width: 3cm;">62814</td>
<td style="text-align: center; width: 3.5cm;">48752</td>
<td style="text-align: center;">14062</td>
<td style="text-align: center; width: 3.7cm;">28.8%</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Auto</td>
<td style="text-align: center;">Non–home-based</td>
<td style="text-align: center; width: 3cm;">1839065</td>
<td style="text-align: center; width: 3.5cm;">2224878</td>
<td style="text-align: center;">-385813</td>
<td style="text-align: center; width: 3.7cm;">-17.3%</td>
</tr>
<tr class="even">
<td style="text-align: center;">Non-motorized</td>
<td style="text-align: center;">Non–home-based</td>
<td style="text-align: center; width: 3cm;">162979</td>
<td style="text-align: center; width: 3.5cm;">146404</td>
<td style="text-align: center;">16575</td>
<td style="text-align: center; width: 3.7cm;">11.3%</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Transit</td>
<td style="text-align: center;">Non–home-based</td>
<td style="text-align: center; width: 3cm;">30513</td>
<td style="text-align: center; width: 3.5cm;">13453</td>
<td style="text-align: center;">17060</td>
<td style="text-align: center; width: 3.7cm;">126.8%</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-calibration-plot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-calibration-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="methods_files/figure-html/fig-calibration-plot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-calibration-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.6: calibration plot
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-tlfd-comp" class="quarto-xref">Figure&nbsp;<span>3.7</span></a> compares the trip length frequency distribution of the two models by mode and purpose. Both ActivitySim and the WFRC model contain destination choice models which can be adjusted to affect the distribution of trip length. However, as the figure shows, the two models have similar TLFDs, so no adjustment was necessary. The most significant discrepancies are with transit trips, again likely due to this configuration of ActivitySim being calibrated to San Francisco, making transit more attractive. Note that though these distributions match well enough for the purposes of this research, further calibration would be required to create a production-ready ActivitySim implementation.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-tlfd-comp" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tlfd-comp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="methods_files/figure-html/fig-tlfd-comp-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tlfd-comp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.7: tlfd comparison
</figcaption>
</figure>
</div>
</div>
</div>
<p>The WFRC model has basic support for predicting telecommuting and work-from-home trips. This includes a lookup table of telecommute percentages based on job type and year. ActivitySim also has this functionality, and can additionally use individual- and household-level variables in its predictions. It is worth noting that both the WFRC model and ActivitySim make a distinction between “telecommuting”, where an individual commutes to work some days and does not others, and “work-from-home” (or “home-based jobs” in the WFRC model), where an individual’s workplace is always at their home.</p>
<p>The ActivitySim implementation discussed in <span class="citation" data-cites="gregory_s_macfarlane_estimation_2021">Gregory S. Macfarlane and Nathan J. Lant (<a href="references.html#ref-gregory_s_macfarlane_estimation_2021" role="doc-biblioref">2021</a>)</span> does not include any submodels related to remote work. However, the example ActivitySim implementation for SEMGOG <em>does</em> include these submodels, and our ActivitySim implementation takes these submodels directly from the SEMCOG example. <strong><em>Some modifications to the remote work submodels were needed for compatibility, but only included….</em></strong></p>
<p>Both models treat “work-from-home”/“home-based jobs” similarly. The WFRC model’s land use data contains employment by type in each TAZ, and it considers a “home-based job” as a separate job type, so these are not counted toward employment totals in trip generation and subsequent steps. <!-- @fig-wfrc-wfh shows the distribution of home-based job percentage by TAZ in the WFRC land use data. --><br>
ActivitySim has a “work from home” submodel which assigns workers work-from-home status based on personal variables such as income, sex, and education (coefficients on these variables were left unchanged from the existing configuration, see <a href="#tbl-asim-wfh-model-coeffs" class="quarto-xref">Table&nbsp;<span>3.4</span></a>). There is also a “target work-from-home percent” value that adjusts the model to reach the specified work-from-home proportion of all workers. Individuals with work-from-home status are then prohibited from making a mandatory tour. This target work-from-home percentage is set at 2.3%, based on a weighted average from the WFRC model data. We made no other adjustments to the ActivitySim work-from-home submodel.</p>
<div class="cell">
<div id="tbl-asim-wfh-model-coeffs" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-asim-wfh-model-coeffs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.4: asim wfh model coeffs
</figcaption>
<div aria-describedby="tbl-asim-wfh-model-coeffs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div>
<table class="do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Description</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Coefficient</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Constant for Working from home</td>
<td style="text-align: right;">0.438</td>
</tr>
<tr class="even">
<td style="text-align: left;">Full time worker (1 if true)</td>
<td style="text-align: right;">-0.812</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Female Worker</td>
<td style="text-align: right;">-0.347</td>
</tr>
<tr class="even">
<td style="text-align: left;">Female worker with a Preschool Child in Household</td>
<td style="text-align: right;">0.573</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Accessibility to workplaces of the home mgra</td>
<td style="text-align: right;">-0.140</td>
</tr>
<tr class="even">
<td style="text-align: left;">Presence of Non Working Adult in the Household</td>
<td style="text-align: right;">-0.372</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Education Level Bachelors or higher degree</td>
<td style="text-align: right;">0.285</td>
</tr>
<tr class="even">
<td style="text-align: left;">Household income Less than 30K</td>
<td style="text-align: right;">-0.393</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Age Group - Less than 35 years</td>
<td style="text-align: right;">-0.574</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age Group - 35 yrs to 45 yrs</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Age Group - 45 yrs to 55 yrs</td>
<td style="text-align: right;">0.214</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age Group - 55 yrs to 65 yrs</td>
<td style="text-align: right;">0.452</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Age Group - Older than 65yrs</td>
<td style="text-align: right;">0.584</td>
</tr>
<tr class="even">
<td style="text-align: left;">ABM2 calibration - work from home</td>
<td style="text-align: right;">-0.016</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Phase2 calibration temp</td>
<td style="text-align: right;">-0.628</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</figure>
</div>
</div>
<p>The two models differ in their approach to telecommuting, however. The WFRC model has a lookup table of telecommuting shares based on job type (see <a href="#tbl-baseline-telecommute" class="quarto-xref">Table&nbsp;<span>3.6</span></a>), including predictions for future years. ActivitySim has a “telecommute frequency” submodel which assigns workers a telecommute status indicating the number of days they work remotely per week. Based on this status, ActivitySim adjusts the likelihood of making a mandatory tour. Telecommute status depends on personal variables similar to those in the work-from-home submodel by default. Notably, the telecommute frequency submodel also includes adjustments based on an individual’s distance to work. No other changes were made to the existing variables in this submodel, and <a href="#tbl-asim-tc-model-coeffs" class="quarto-xref">Table&nbsp;<span>3.5</span></a> shows the submodel coefficients.</p>
<div class="cell">
<div id="tbl-asim-tc-model-coeffs" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-asim-tc-model-coeffs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.5: asim tc model coeffs
</figcaption>
<div aria-describedby="tbl-asim-tc-model-coeffs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div>
<table class="do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Description</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">1_day_week</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2_3_days_week</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">4_days_week</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Retail</td>
<td style="text-align: right;">0.312</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">0.078</td>
</tr>
<tr class="even">
<td style="text-align: left;">Food</td>
<td style="text-align: right;">-0.368</td>
<td style="text-align: right;">-0.148</td>
<td style="text-align: right;">-0.092</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Manufacturing</td>
<td style="text-align: right;">0.038</td>
<td style="text-align: right;">0.015</td>
<td style="text-align: right;">0.010</td>
</tr>
<tr class="even">
<td style="text-align: left;">not sure, unused</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Office</td>
<td style="text-align: right;">1.782</td>
<td style="text-align: right;">0.712</td>
<td style="text-align: right;">0.445</td>
</tr>
<tr class="even">
<td style="text-align: left;">Government and education</td>
<td style="text-align: right;">-0.560</td>
<td style="text-align: right;">-0.224</td>
<td style="text-align: right;">-0.140</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Health</td>
<td style="text-align: right;">0.158</td>
<td style="text-align: right;">0.063</td>
<td style="text-align: right;">0.039</td>
</tr>
<tr class="even">
<td style="text-align: left;">other</td>
<td style="text-align: right;">1.535</td>
<td style="text-align: right;">0.614</td>
<td style="text-align: right;">0.384</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Agriculture</td>
<td style="text-align: right;">2.262</td>
<td style="text-align: right;">0.904</td>
<td style="text-align: right;">0.566</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mining</td>
<td style="text-align: right;">-2.030</td>
<td style="text-align: right;">-0.810</td>
<td style="text-align: right;">-0.511</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Construction</td>
<td style="text-align: right;">0.816</td>
<td style="text-align: right;">0.326</td>
<td style="text-align: right;">0.204</td>
</tr>
<tr class="even">
<td style="text-align: left;">Has children 0 to 5 years old</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">-0.864</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Has children 6 to 12 years old</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.517</td>
<td style="text-align: right;">-0.810</td>
</tr>
<tr class="even">
<td style="text-align: left;">One adult in hh</td>
<td style="text-align: right;">0.177</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">-0.043</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2 or more adults in hh</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">female</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Part-time worker</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.425</td>
<td style="text-align: right;">1.112</td>
</tr>
<tr class="even">
<td style="text-align: left;">College student</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.600</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pays to park</td>
<td style="text-align: right;">0.457</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">Income 60-100k</td>
<td style="text-align: right;">0.560</td>
<td style="text-align: right;">0.389</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Income 100-150k</td>
<td style="text-align: right;">0.644</td>
<td style="text-align: right;">0.193</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">Income 150k+</td>
<td style="text-align: right;">0.920</td>
<td style="text-align: right;">0.765</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0 Autos</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.407</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1 Auto</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3+ Autos</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">-0.730</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">Distance to work</td>
<td style="text-align: right;">0.016</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">temp_calibration</td>
<td style="text-align: right;">-4.000</td>
<td style="text-align: right;">-4.250</td>
<td style="text-align: right;">-6.000</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</figure>
</div>
</div>
<p>In order to calibrate ActivitySim’s telecommute frequency submodel to the WFRC data, however, we added additional job type variables to ActivitySim to match those given in <a href="#tbl-baseline-telecommute" class="quarto-xref">Table&nbsp;<span>3.6</span></a>. Because these are choice coefficients rather than target percentages, the values needed to be calibrated to match the WFRC targets. The calibration allowed ActivitySim to match these targets exactly, and the coefficients are given in <a href="#tbl-baseline-telecommute" class="quarto-xref">Table&nbsp;<span>3.6</span></a>.</p>
<div class="cell">
<div id="tbl-baseline-telecommute" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-baseline-telecommute-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.6: wfrc telecommute data
</figcaption>
<div aria-describedby="tbl-baseline-telecommute-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div>
<table class="table do-not-create-environment cell table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; empty-cells: hide; border-bottom: hidden;"></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
ActivitySim Telecommute Utility Coefficients
</div></th>
</tr>
<tr class="odd">
<th style="text-align: center;" data-quarto-table-cell-role="th">Job Type</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">WFRC Telecommute %</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">1 day</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">2–3 days</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">4 days</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Retail</td>
<td style="text-align: center;">2.70%</td>
<td style="text-align: center;">0.312</td>
<td style="text-align: center;">0.125</td>
<td style="text-align: center;">0.078</td>
</tr>
<tr class="even">
<td style="text-align: center;">Food</td>
<td style="text-align: center;">1.87%</td>
<td style="text-align: center;">-0.368</td>
<td style="text-align: center;">-0.148</td>
<td style="text-align: center;">-0.092</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Manufacturing</td>
<td style="text-align: center;">2.02%</td>
<td style="text-align: center;">0.038</td>
<td style="text-align: center;">0.015</td>
<td style="text-align: center;">0.010</td>
</tr>
<tr class="even">
<td style="text-align: center;">Office</td>
<td style="text-align: center;">6.66%</td>
<td style="text-align: center;">1.782</td>
<td style="text-align: center;">0.712</td>
<td style="text-align: center;">0.445</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Gov't/Education</td>
<td style="text-align: center;">1.67%</td>
<td style="text-align: center;">-0.560</td>
<td style="text-align: center;">-0.224</td>
<td style="text-align: center;">-0.140</td>
</tr>
<tr class="even">
<td style="text-align: center;">Health</td>
<td style="text-align: center;">2.86%</td>
<td style="text-align: center;">0.158</td>
<td style="text-align: center;">0.063</td>
<td style="text-align: center;">0.039</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Agriculture</td>
<td style="text-align: center;">6.93%</td>
<td style="text-align: center;">2.262</td>
<td style="text-align: center;">0.904</td>
<td style="text-align: center;">0.566</td>
</tr>
<tr class="even">
<td style="text-align: center;">Mining</td>
<td style="text-align: center;">0.53%</td>
<td style="text-align: center;">-2.030</td>
<td style="text-align: center;">-0.810</td>
<td style="text-align: center;">-0.511</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Construction</td>
<td style="text-align: center;">3.28%</td>
<td style="text-align: center;">0.816</td>
<td style="text-align: center;">0.326</td>
<td style="text-align: center;">0.204</td>
</tr>
<tr class="even">
<td style="text-align: center;">Other</td>
<td style="text-align: center;">5.37%</td>
<td style="text-align: center;">1.535</td>
<td style="text-align: center;">0.614</td>
<td style="text-align: center;">0.384</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</figure>
</div>
</div>
<p>Because both remote work submodels in ActivitySim are run before an individual’s DAP is chosen, ActivitySim implicitly models a “rebound effect”, where individuals working remotely on any given day may be more likely to make discretionary tours. However, because the WFRC model does not include this effect, the ActivitySim DAP model is left unchanged. <a href="#tbl-asim-dap-model-rw-coeffs" class="quarto-xref">Table&nbsp;<span>3.7</span></a> shows the coefficients of the DAP model for individuals who work remotely.</p>
<div class="cell">
<div id="tbl-asim-dap-model-rw-coeffs" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-asim-dap-model-rw-coeffs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.7: asim dap model remote work coeffs
</figcaption>
<div aria-describedby="tbl-asim-dap-model-rw-coeffs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div>
<table class="do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mpg</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cyl</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">disp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">hp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">drat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">wt</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">qsec</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">vs</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">am</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">gear</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">carb</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Mazda RX4</td>
<td style="text-align: right;">21.0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">160</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.90</td>
<td style="text-align: right;">2.62</td>
<td style="text-align: right;">16.5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mazda RX4 Wag</td>
<td style="text-align: right;">21.0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">160</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.90</td>
<td style="text-align: right;">2.88</td>
<td style="text-align: right;">17.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Datsun 710</td>
<td style="text-align: right;">22.8</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">3.85</td>
<td style="text-align: right;">2.32</td>
<td style="text-align: right;">18.6</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hornet 4 Drive</td>
<td style="text-align: right;">21.4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">258</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.08</td>
<td style="text-align: right;">3.21</td>
<td style="text-align: right;">19.4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hornet Sportabout</td>
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">360</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">3.15</td>
<td style="text-align: right;">3.44</td>
<td style="text-align: right;">17.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Valiant</td>
<td style="text-align: right;">18.1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">225</td>
<td style="text-align: right;">105</td>
<td style="text-align: right;">2.76</td>
<td style="text-align: right;">3.46</td>
<td style="text-align: right;">20.2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</figure>
</div>
</div>
</section>
</section>
<section id="example-scenarios" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="example-scenarios"><span class="header-section-number">3.4</span> Example Scenarios</h2>
<p>There are three proposed scenarios to implement and run in each model for comparison. This is not a comprehensive list covering all potential scenario possibilities, but is taken to represent many of the types of scenarios an agency would analyze.</p>
<p>The first scenario involves a change in land use near the former state prison site in Draper, Utah. Current plans for this site involve new development known as “The Point”, which will add high-density housing and commercial development to the area. This research scenario will be based on this development, but will include only the land use changes. The actual development plans also include expansion of transit, but this will not be a part of this scenario.</p>
<p>The second scenario centers around an augmentation of transit service along the Wasatch Front. The FrontRunner, a CRT line connecting Provo to Ogden, is slated for expansion. The expansion includes additional stations and increased travel speeds due to vehicle electrification. This scenario models these changes in accordance with the planned expansion of the service.</p>
<p>The third scenario addresses the growing trend of remote work. Given technological advancements and the notable surge in remote work during the COVID-19 pandemic, this scenario models a substantial increase in remote work based on projections from WFRC.</p>
<p>Each of these scenarios is based on the baseline 2019 scenario in the respective model, and ignores any additional expected growth or development beyond the specific changes of each scenario. For example, the increased WFH scenario uses WFH projections from 2050, but land use and socioeconomic data from 2019. These scenarios are therefore not realistic, but they serve as illustrative examples of the types of planning and development scenarios agencies may wish to analyze.</p>
<p>All three of these scenarios are coded in both the WFRC model and ActivitySim. The results (Chapters <a href="1_land_use.html" class="quarto-xref"><span>4</span></a>–<a href="3_wfh.html" class="quarto-xref"><span>6</span></a>) describe the process of coding each scenario and analyzing them, as well as the analyses themselves.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-populationsim_2023" class="csl-entry" role="listitem">
Association of Metropolitan Planning Organizations. 2023. <span>“<span>PopulationSim</span>.”</span> <a href="https://activitysim.github.io/populationsim">https://activitysim.github.io/populationsim</a>.
</div>
<div id="ref-bentley_systems_cube" class="csl-entry" role="listitem">
Bentley Systems. n.d. <span>“<span>CUBE</span> <span>Modeling</span> <span>Software</span>.”</span> Accessed October 3, 2023. <a href="https://www.bentley.com/software/cube/">https://www.bentley.com/software/cube/</a>.
</div>
<div id="ref-erhardt_mtcs_2011" class="csl-entry" role="listitem">
Erhardt, Greg, David Ory, San Francisco, Amar Sarvepalli, Joel Freedman, Jeff Hood, and Ben Stabler. 2011. <span>“<span>MTC</span>’s <span>Travel</span> <span>Model</span> <span>One</span>: <span>Applications</span> of an <span>Activity</span>‐<span>Based</span> <span>Model</span> in Its <span>First</span> <span>Year</span>.”</span> <em>Innovations in Travel Modeling 2012</em>, November.
</div>
<div id="ref-gregory_s_macfarlane_estimation_2021" class="csl-entry" role="listitem">
Gregory S. Macfarlane, and Nathan J. Lant. 2021. <span>“Estimation and <span>Simulation</span> of <span>Daily</span> <span>Activity</span> <span>Patterns</span> for <span>Individuals</span> <span>Using</span> <span>Wheelchairs</span>.”</span> Final UT-21.10. Utah Department of Transportation. <a href="https://drive.google.com/file/d/1PMJ_7zOPqghjelPl7QdwAB_fK-0RLmx4/view?usp=sharing&amp;usp=embed_facebook">https://drive.google.com/file/d/1PMJ_7zOPqghjelPl7QdwAB_fK-0RLmx4/view?usp=sharing&amp;usp=embed_facebook</a>.
</div>
<div id="ref-pums" class="csl-entry" role="listitem">
U.S. Census Bureau. 2022. <span>“Public <span>Use</span> <span>Microdata</span> <span>Sample</span> (<span>PUMS</span>).”</span> <em>Census.gov</em>. <a href="https://www.census.gov/programs-surveys/acs/microdata.html">https://www.census.gov/programs-surveys/acs/microdata.html</a>.
</div>
<div id="ref-puma" class="csl-entry" role="listitem">
———. 2023. <span>“Public <span>Use</span> <span>Microdata</span> <span>Areas</span> (<span>PUMAs</span>).”</span> <em>Census.gov</em>. <a href="https://www.census.gov/programs-surveys/geography/guidance/geo-areas/pumas.html">https://www.census.gov/programs-surveys/geography/guidance/geo-areas/pumas.html</a>.
</div>
<div id="ref-zegras_household_2007" class="csl-entry" role="listitem">
Zegras, P. Christopher, and Sumeeta Srinivasan. 2007. <span>“Household <span>Income</span>, <span>Travel</span> <span>Behavior</span>, <span>Location</span>, and <span>Accessibility</span>: <span>Sketches</span> from <span>Two</span> <span>Different</span> <span>Developing</span> <span>Contexts</span>.”</span> <em>Transportation Research Record</em> 2038 (1): 128–38. <a href="https://doi.org/10.3141/2038-17">https://doi.org/10.3141/2038-17</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../qmd/lit-review.html" class="pagination-link" aria-label="Literature Review">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Literature Review</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../qmd/1_land_use.html" class="pagination-link" aria-label="Scenario 1: Change in Land Use">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Scenario 1: Change in Land Use</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>