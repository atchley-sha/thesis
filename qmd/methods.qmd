# Methodology {#sec-methods}

{{< include _setup.qmd >}}

To compare the practical differences in using trip-based models and modern activity-based models, we design an experiment to analyze three scenarios in two representative model platforms.
The two models are:

-   An advanced trip-based model developed by WFRC and the Mountainland Association of Governments (MAG) for the agencies' long range planning efforts in the Salt Lake City - Ogden - Provo metropolitan region in Utah. This will be referred to as the **WFRC/MAG** model.
-   An implementation of the **ActivitySim** open-source travel demand modeling framework for the same region.

The remainder of this section describes each model, presents preliminary validation checks comparing the two models, and briefly describes the scenarios analyzed in the remainder of the paper.

## WFRC Model

The WFRC/MAG model is implemented in the CUBE software [@bentley_systems_cube].
WFRC provided the model directly, including land use forecasts and scenarios from the current most recent long-range transportation plan.
@fig-wfrc-flowchart gives an overview of the WFRC model, showing broad model steps in a flowchart.
Like many trip-based models, the WFRC model follows the "four-step" approach and has main steps of trip generation, trip distribution, mode choice, and network assignment.
The model also includes a household classification step where zonal data is transformed to de-aggregate the number of households by size, income group, number of workers, and auto ownership.

![WFRC model flowchart. The distribution step includes a feedback loop where preliminary loaded network skims are used to perform subsequent iterations of trip distribution until the distribution converges.](./../images/wfrc_flowchart.png){#fig-wfrc-flowchart fig-scap="WFRC model flowchart."}

The rest of the model proceeds in a typical trip-based manner, with trip production and attraction rates by purpose and household segmentation, a trip distribution model that is gravity-based for all trips other than home-based work (which is a destination choice model), a nested logit mode choice model, and a multiclass static highway assignment.
The model is calibrated to 2019 base year information for Utah, Salt Lake, Davis, Weber, and portions of Box Elder counties.

## ActivitySim {#sec-activitysim}

ActivitySim is an open-source tour-based model with development led by a consortium of transportation planning agencies.
This paper uses an ActivitySim implementation described by Macfarlane et al. @macfarlaneEstimationSimulationDaily2021, which is in turn based on the prototype configuration for the Metropolitan Transportation Commission serving the San Francisco area [@erhardt_mtcs_2011].
ActivitySim simulates transportation related decisions as described in @fig-asim-flowchart where agents make long-term decisions (such as auto ownership and telecommute frequency) first, followed by daily and tour- and trip-level decisions some of which are joint with other household members.

![ActivitySim sub-model flowchart. [@activitysim]](../images/abmexample.jpg){#fig-asim-flowchart fig-scap="ActivitySim sub-model flowchart."}

ActivitySim requires two general inputs: a synthetic population representing the model region and transportation impedance data by mode.
For the synthetic population, we supplied the zone-level household count data from the WFRC/MAG model to PopulationSim [@populationsim_2023].
We then supplied additional Census tract-level targets for age, income, worker status, and household size derived from the American Community Survey (ACS) 2015-2019 five-year data, along with a seed population drawn from the ACS Public Use Microdata Sample (PUMS) [@pums].
For transportation impedance, we used the congested skims from the WFRC/MAG base scenario as inputs to the accessibilities model of Activitysim.

A complete calibration of each ActivitySim submodule is beyond the scope of this research, and is not necessary for the discussion we wish to pursue.
We did, however, validate that the synthetic population matched the zonal socioeconomic data in terms of population and median income, and that the trip length frequencies were similar by mode and purpose to the WFRC/MAG model.
We also ensured that the calibration year work from home and telecommute frequency models placed similar numbers of workers in the relevant categories (more details on the work from home and telecommute models is discussed in Scenario 3 below).
Finally, we loosely calibrated the tour and trip mode choice model using share targets derived from the WFRC/MAG model; @tbl-mode-split shows the results of this exercise.
In general, the ActivitySim model over-predicts the share of transit and non-motorized trips for all purposes relative to the WFRC/MAG targets.

```{r}
#| label: tbl-mode-split
#| tbl-cap: Comparison of Mode Split Between Models After Calibration

x <- targets::tar_read(mc_comparison) %>%
    mutate(wfrc_share = if_else(mode == "Ridehail", "\u2014\u00b9", wfrc_share)) %>%
    ungroup() %>%
    `colnames<-`(c("Purpose", "Mode", "Trips", "Share", "Trips", "Share")) %>%
    skbl(digits = 0) %>%
    kable_styling() %>%
    add_header_above(c(" " = 2, "ActivitySim" = 2, "WFRC Model" = 2)) %>%
    collapse_rows(1, latex_hline = "major") %>%
    kableExtra::footnote(number = "Ridehail mode shares were asserted for mode choice calibration, but are not counted here", threeparttable = TRUE)

if (!knitr::pandoc_to("docx")) {
    x
} else {
    library(flextable)
    ft <- flextable(airquality[sample.int(10), ])
    ft
}
```

## Example Scenarios

With these two models, we analyze three scenarios to implement and analyze in each model for comparison.
These scenarios are intended to represent common analysis tasks for which agencies use models, but do not of course exhaust all possible combinations.
Each of these scenarios is based on the baseline 2019 scenario in the respective model, and ignores any additional expected growth or development beyond the specific changes of each scenario.
The three scenarios are:

1.  **A change in land use**. The first scenario involves a change in land use near a former state prison site in Draper, Utah. Current plans for this site involve new development known as "The Point," which will add high-density housing and commercial development to the area.
2.  **A change in transport services**. The second scenario respresents an augmentation of commuter rail service along the Wasatch Front. The FrontRunner, a commuter rail line connecting Provo to Ogden, is slated for expansion. The expansion includes additional stations and increased travel speeds due to vehicle electrification.
3.  **A change in travel behavior**. The final scenario compares efforts to represent increased work from home and telecommuting behaviors, a common task for agencies in the post COVID-19 planning environment.

The next three sections describe the scenario implementation in both model frameworks, and the task of analyzing the modeled scenario outcomes.
